# 摄像头服务器项目需求文档
版本： 0.3 (移除 Wasm 核心考量)
日期： 2025-05-12
作者： [您的名字/团队名，待填写]
项目名称： RK3588 摄像头服务器与 Web 客户端

1. 引言
1.1. 项目背景与目标
本项目旨在利用瑞芯微 RK3588 开发板（如香橙派 5 Plus）的硬件能力，构建一个功能强大的摄像头服务器。该服务器应能够连接摄像头，实现视频流的采集、编码和录制。同时，项目需要实现将已录制的视频文件拆解为一系列静态图像帧的功能。为了方便用户操作和管理，将开发一个基于 Web 浏览器的客户端界面，用户可以通过任何设备的浏览器远程访问、控制服务器的功能并获取其状态信息。

核心目标是提供一个稳定、高效的远程摄像头解决方案，支持视频录制和后续的图像帧提取，并通过通用的 Web 浏览器提供便捷的访问和控制方式。

1.2. 目标用户
公司自己的应用需要进行视频录制和图像帧提取。

希望构建自定义视频监控或图像处理系统的用户。

1.3. 术语定义
RK3588 开发板： 指搭载瑞芯微 RK3588 芯片的单板计算机，如香橙派 5 Plus。

服务器： 指运行在 RK3588 开发板上的核心程序，负责摄像头控制、录制和拆分。

Web 客户端： 指用户通过 Web 浏览器访问的界面，运行在浏览器中，用于与服务器通信并提供用户界面。

视频采集： 指从摄像头获取原始视频流的过程。

视频录制： 指将视频流编码并保存为视频文件的过程。

视频拆分： 指将视频文件中的每一帧或按一定间隔的帧提取并保存为静态图像文件的过程。

2. 项目范围
2.1. 核心功能范围
视频采集： 支持从连接的摄像头采集指定分辨率和帧率的视频流。

视频录制： 支持将采集到的视频流编码为指定格式的视频文件，并保存到本地存储。支持按需启动和停止录制。

视频拆分： 支持指定已录制的视频文件，将其解码并按指定参数（如帧率、格式）拆分成静态图像帧，保存到指定目录。

服务器 API： 提供网络接口（如 RESTful API）供Web 客户端远程控制采集、录制、拆分等功能，并获取服务器状态和文件列表。

Web 客户端： 提供基于浏览器的用户界面，通过调用服务器 API 实现远程控制和状态显示，可从任何支持现代 Web 浏览器的设备访问。

2.2. 排除的功能 (本阶段不包含)
实时视频流预览在客户端（除非通过高效协议或优化实现成本较低）。

高级视频分析功能（如目标识别、行为分析）。

多摄像头同时采集和管理。

视频流的直播或推流功能。

远程文件上传或下载（仅限文件列表和触发拆分）。

用户认证和权限管理（仅考虑基本的 API 安全性）。

3. 功能需求 (Functional Requirements)
3.1. 视频采集 (FR-CAP)
FR-CAP-1: 服务器应能检测并初始化连接到 RK3588 开发板的摄像头。

FR-CAP-2: 服务器应能通过 API 接收客户端指令，启动或停止视频采集。

FR-CAP-3: 服务器应支持配置采集参数，如分辨率（例如 1920x1080, 3840x2160）和帧率（例如 30fps, 60fps）。

FR-CAP-4: 服务器应能在采集过程中保持稳定的帧率，减少丢帧。

3.2. 视频录制 (FR-REC)
FR-REC-1: 服务器应能将采集到的视频流实时编码为指定格式（例如 MP4, H.264）的视频文件。

FR-REC-2: 服务器应能通过 API 接收客户端指令，开始或停止视频录制。

FR-REC-3: 录制文件应自动按规则命名，包含时间戳和可能的序列号，并保存到预设的存储路径。

FR-REC-4: （可选）支持配置录制文件的最大时长或大小，达到限制后自动分段创建新文件。

FR-REC-5: 录制过程中应能通过 API 查询当前录制状态和文件名。

3.3. 视频拆分 (FR-SPLIT)
FR-SPLIT-1: 服务器应能通过 API 接收客户端指令，指定一个已录制的视频文件路径作为输入。

FR-SPLIT-2: 服务器应能对指定的视频文件进行解码。

FR-SPLIT-3: 服务器应能按照指定的帧提取频率（例如每秒 N 帧，或每隔 N 帧）从视频中提取静态图像帧。

FR-SPLIT-4: 提取出的图像帧应保存为指定格式（例如 JPEG, PNG）的图片文件到指定的输出目录。

FR-SPLIT-5: 拆分出的图片文件应自动按规则命名，包含原视频文件名和帧序号。

FR-SPLIT-6: 拆分过程应通过 API 提供进度查询功能。

FR-SPLIT-7: 支持通过 API 取消正在进行的拆分任务。

3.4. 服务器 API (FR-API)
FR-API-1: 服务器应提供基于 HTTP/HTTPS 的 RESTful API 接口。

FR-API-2: API 应包含用于启动/停止采集的端点（例如 /capture/start, /capture/stop）。

FR-API-3: API 应包含用于启动/停止录制的端点（例如 /record/start, /record/stop）。

FR-API-4: API 应包含用于触发视频拆分的端点（例如 /split/start），接受源文件路径、输出路径和拆分参数作为请求体。

FR-API-5: API 应包含用于查询拆分任务状态的端点（例如 /split/status?task_id=...）。

FR-API-6: API 应包含获取服务器当前状态的端点（例如 /status），返回采集状态、录制状态、存储空间、CPU/内存使用率等信息。

FR-API-7: API 应包含获取录制文件列表的端点（例如 /files/recorded）。

FR-API-8: API 应包含获取已拆分图片文件列表的端点（例如 /files/frames?video_id=...）。

FR-API-9: API 接口应具备基本的安全性措施，例如通过 API Key 或简单的用户名/密码进行认证。

3.5. Web 客户端 (FR-CLI)
FR-CLI-1: 客户端应是一个可通过 Web 浏览器访问的界面。

FR-CLI-2: 客户端应能通过界面配置服务器的 IP 地址和端口进行连接。

FR-CLI-3: 客户端界面应直观显示服务器的当前状态（采集、录制状态）。

FR-CLI-4: 客户端界面应提供按钮或控件，允许用户方便地触发和控制服务器端的采集、录制和拆分功能。

FR-CLI-5: 客户端应能显示服务器上的录制文件列表。

FR-CLI-6: 客户端应允许用户选择录制文件，配置拆分参数，并触发拆分操作。

FR-CLI-7: 客户端应能显示拆分任务的进度和结果。

FR-CLI-8: （可选）客户端应能显示已拆分出的图像帧的缩略图或列表。

4. 非功能需求 (Non-Functional Requirements)
NFR-PERF-1: 视频采集和录制应能稳定运行，保证视频流畅性。

NFR-PERF-2: 视频拆分性能应尽可能优化，充分利用 RK3588 的解码能力。

NFR-RELY-1: 服务器端程序应具备一定的鲁棒性，能够处理常见的错误（如摄像头断开、存储空间不足）并记录日志。

NFR-USAB-1: Web 客户端界面应简洁易用，操作流程清晰，并具备良好的响应式设计，适应不同屏幕尺寸的设备。

NFR-USAB-2: 服务器端应提供清晰的安装和配置文档。

NFR-SECU-1: 服务器 API 应防止未经授权的访问。

NFR-SECU-2: 考虑使用 HTTPS 保护 API 通信。

NFR-RESO-1: 服务器端程序应合理利用 RK3588 的 CPU、内存和存储资源。

NFR-MAINT-1: 代码应模块化，便于维护和功能扩展。

NFR-MAINT-2: 提供详细的日志记录，方便故障排查。

5. 技术架构考量
5.1. 服务器端 (RK3588):

操作系统： 建议使用 Radxa OS 或 Armbian 等为 RK3588 优化的 Debian/Ubuntu 发行版。

摄像头接口： 使用 V4L2 API 进行底层采集。

视频处理框架： 考虑使用 FFmpeg 或 GStreamer，利用 Rockchip 提供的硬件加速插件进行编码和解码。

API 实现：

可以使用 Go 或 Rust 编写高性能的 Web 服务器，直接实现 API。

Web Server： 需要一个轻量级的 Web 服务器来托管 Web 客户端的静态文件（HTML, CSS, JavaScript）并处理 API 请求。

进程管理： 可以使用 systemd 管理采集、录制、API 服务等进程。

5.2. 客户端 (Web):

客户端类型： 基于标准的 Web 技术实现。

技术栈： HTML, CSS, JavaScript (可能使用现代前端框架如 React, Vue, Angular)。

通信协议： 使用 Fetch API 或 XMLHttpRequest 进行 HTTP/HTTPS API 调用，可以考虑 WebSocket 进行实时状态更新。

6. 未来增强 (Optional Features)
FE-1: 客户端实时视频流预览。

FE-2: 自动化录制和拆分计划。

FE-3: 集成图像分析功能。

FE-4: 多摄像头支持。

FE-5: 云存储同步。

FE-6: 用户认证和权限管理系统。

FE-7: 探索在客户端或服务器端使用 WebAssembly (Wasm) 进行特定高性能计算任务的可能性。